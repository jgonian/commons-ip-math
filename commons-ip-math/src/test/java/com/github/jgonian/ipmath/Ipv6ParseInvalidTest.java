/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2011-2017, Yannis Gonianakis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
package com.github.jgonian.ipmath;

import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.ExpectedException;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;
import org.junit.runners.Parameterized.Parameter;
import org.junit.runners.Parameterized.Parameters;

import java.util.Arrays;
import java.util.List;

@RunWith(Parameterized.class)
public class Ipv6ParseInvalidTest {

    @Rule
    public ExpectedException thrown = ExpectedException.none();

    @Parameter(0)
    public String input;

    @Test
    public void test() {
        thrown.expect(IllegalArgumentException.class);
        thrown.expectMessage("Invalid IPv6 address: '" + input + "'");
        Ipv6.parse(input);
    }

    // Invalid IPv6 examples are copied from http://download.dartware.com/thirdparty/test-ipv6-regex.pl
    @Parameters(name = "{index}: parse({0})")
    public static List<Object> data() {
        return Arrays.asList(new Object[]{
                "",                                             // empty string
                "2001:DB8:0:0:8:800:200C:417A:221",             // unicast, full
                "FF01::101::2",                                 // multicast, compressed

                "02001:0000:1234:0000:0000:C1C0:ABCD:0876",     // extra 0 not allowed!
                "2001:0000:1234:0000:00001:C1C0:ABCD:0876",     // extra 0 not allowed!
                "2001:0000:1234:0000:0000:C1C0:ABCD:0876  0",   // junk after valid address
                "2001:0000:1234: 0000:0000:C1C0:ABCD:0876",     // internal space

                "3ffe:0b00:0000:0001:0000:0000:000a",           // seven segments
                "FF02:0000:0000:0000:0000:0000:0000:0000:0001", // nine segments
                "3ffe:b00::1::a",                               // double "::"
                "::1111:2222:3333:4444:5555:6666::",            // double "::"

                "1:2:3::4:5::7:8",                              // Double "::"
                "12345::6:7:8",

                // IPv4 addresses as dotted-quads
                "1::5:400.2.3.4",
                "1::5:260.2.3.4",
                "1::5:256.2.3.4",
                "1::5:1.256.3.4",
                "1::5:1.2.256.4",
                "1::5:1.2.3.256",
                "1::5:300.2.3.4",
                "1::5:1.300.3.4",
                "1::5:1.2.300.4",
                "1::5:1.2.3.300",
                "1::5:900.2.3.4",
                "1::5:1.900.3.4",
                "1::5:1.2.900.4",
                "1::5:1.2.3.900",
                "1::5:300.300.300.300",
                "1::5:3000.30.30.30",
                "1::400.2.3.4",
                "1::260.2.3.4",
                "1::256.2.3.4",
                "1::1.256.3.4",
                "1::1.2.256.4",
                "1::1.2.3.256",
                "1::300.2.3.4",
                "1::1.300.3.4",
                "1::1.2.300.4",
                "1::1.2.3.300",
                "1::900.2.3.4",
                "1::1.900.3.4",
                "1::1.2.900.4",
                "1::1.2.3.900",
                "1::300.300.300.300",
                "1::3000.30.30.30",
                "::400.2.3.4",
                "::260.2.3.4",
                "::256.2.3.4",
                "::1.256.3.4",
                "::1.2.256.4",
                "::1.2.3.256",
                "::300.2.3.4",
                "::1.300.3.4",
                "::1.2.300.4",
                "::1.2.3.300",
                "::900.2.3.4",
                "::1.900.3.4",
                "::1.2.900.4",
                "::1.2.3.900",
                "::300.300.300.300",
                "::3000.30.30.30",
                "2001:1:1:1:1:1:255Z255X255Y255",                // garbage instead of "." in IPv4
                "::ffff:192x168.1.26",                           // ditto
                "::ffff:2.3.4",
                "::ffff:257.1.2.3",
                "1.2.3.4",

                "1.2.3.4:1111:2222:3333:4444::5555",  // Aeron
                "1.2.3.4:1111:2222:3333::5555",
                "1.2.3.4:1111:2222::5555",
                "1.2.3.4:1111::5555",
                "1.2.3.4::5555",
                "1.2.3.4::",

                // Testing IPv4 addresses represented as dotted-quads
                // Leading zero's in IPv4 addresses not allowed: some systems treat the leading "0" in ".086" as the start of an octal number
                // Update: The BNF in RFC-3986 explicitly defines the dec-octet (for IPv4 addresses) not to have a leading zero
                "fe80:0000:0000:0000:0204:61ff:254.157.241.086",
                "XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:1.2.3.4",
                "1111:2222:3333:4444:5555:6666:00.00.00.00",
                "1111:2222:3333:4444:5555:6666:000.000.000.000",
                "1111:2222:3333:4444:5555:6666:256.256.256.256",

                // "124.15.6.89/60",// standard IPv4, prefix not allowed
                ":",

                // Aeron supplied these test cases
                "1111:2222:3333:4444::5555:",
                "1111:2222:3333::5555:",
                "1111:2222::5555:",
                "1111::5555:",
                "::5555:",
                ":::",
                "1111:",
                ":",

                ":1111:2222:3333:4444::5555",
                ":1111:2222:3333::5555",
                ":1111:2222::5555",
                ":1111::5555",
                ":::5555",
                ":::",

                "123",
                "ldkfj",
                "2001::FFD3::57ab",
                "2001:db8:85a3::8a2e:37023:7334",
                "2001:db8:85a3::8a2e:370k:7334",
                "1:2:3:4:5:6:7:8:9",
                "1::2::3",
                "1:::3:4:5",
                "1:2:3::4:5:6:7:8:9",

                // New invalid from Aeron
                // Invalid data
                "XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX",

                // Too many components
                "1111:2222:3333:4444:5555:6666:7777:8888:9999",
                "1111:2222:3333:4444:5555:6666:7777:8888::",
                "::2222:3333:4444:5555:6666:7777:8888:9999",

                // Too few components
                "1111:2222:3333:4444:5555:6666:7777",
                "1111:2222:3333:4444:5555:6666",
                "1111:2222:3333:4444:5555",
                "1111:2222:3333:4444",
                "1111:2222:3333",
                "1111:2222",
                "1111",

                // Missing :
                "11112222:3333:4444:5555:6666:7777:8888",
                "1111:22223333:4444:5555:6666:7777:8888",
                "1111:2222:33334444:5555:6666:7777:8888",
                "1111:2222:3333:44445555:6666:7777:8888",
                "1111:2222:3333:4444:55556666:7777:8888",
                "1111:2222:3333:4444:5555:66667777:8888",
                "1111:2222:3333:4444:5555:6666:77778888",

                // Missing : intended for ::
                "1111:2222:3333:4444:5555:6666:7777:8888:",
                "1111:2222:3333:4444:5555:6666:7777:",
                "1111:2222:3333:4444:5555:6666:",
                "1111:2222:3333:4444:5555:",
                "1111:2222:3333:4444:",
                "1111:2222:3333:",
                "1111:2222:",
                "1111:",
                ":",
                ":8888",
                ":7777:8888",
                ":6666:7777:8888",
                ":5555:6666:7777:8888",
                ":4444:5555:6666:7777:8888",
                ":3333:4444:5555:6666:7777:8888",
                ":2222:3333:4444:5555:6666:7777:8888",
                ":1111:2222:3333:4444:5555:6666:7777:8888",

                // :::
                ":::2222:3333:4444:5555:6666:7777:8888",
                "1111:::3333:4444:5555:6666:7777:8888",
                "1111:2222:::4444:5555:6666:7777:8888",
                "1111:2222:3333:::5555:6666:7777:8888",
                "1111:2222:3333:4444:::6666:7777:8888",
                "1111:2222:3333:4444:5555:::7777:8888",
                "1111:2222:3333:4444:5555:6666:::8888",
                "1111:2222:3333:4444:5555:6666:7777:::",

                // Double ::",
                "::2222::4444:5555:6666:7777:8888",
                "::2222:3333::5555:6666:7777:8888",
                "::2222:3333:4444::6666:7777:8888",
                "::2222:3333:4444:5555::7777:8888",
                "::2222:3333:4444:5555:7777::8888",
                "::2222:3333:4444:5555:7777:8888::",

                "1111::3333::5555:6666:7777:8888",
                "1111::3333:4444::6666:7777:8888",
                "1111::3333:4444:5555::7777:8888",
                "1111::3333:4444:5555:6666::8888",
                "1111::3333:4444:5555:6666:7777::",

                "1111:2222::4444::6666:7777:8888",
                "1111:2222::4444:5555::7777:8888",
                "1111:2222::4444:5555:6666::8888",
                "1111:2222::4444:5555:6666:7777::",

                "1111:2222:3333::5555::7777:8888",
                "1111:2222:3333::5555:6666::8888",
                "1111:2222:3333::5555:6666:7777::",

                "1111:2222:3333:4444::6666::8888",
                "1111:2222:3333:4444::6666:7777::",

                "1111:2222:3333:4444:5555::7777::",


                // Too many components"
                "1111:2222:3333:4444:5555:6666:7777:8888:1.2.3.4",
                "1111:2222:3333:4444:5555:6666:7777:1.2.3.4",
                "1111:2222:3333:4444:5555:6666::1.2.3.4",
                "::2222:3333:4444:5555:6666:7777:1.2.3.4",
                "1111:2222:3333:4444:5555:6666:1.2.3.4.5",

                // Too few components
                "1111:2222:3333:4444:5555:1.2.3.4",
                "1111:2222:3333:4444:1.2.3.4",
                "1111:2222:3333:1.2.3.4",
                "1111:2222:1.2.3.4",
                "1111:1.2.3.4",
                "1.2.3.4",

                // Missing :
                "11112222:3333:4444:5555:6666:1.2.3.4",
                "1111:22223333:4444:5555:6666:1.2.3.4",
                "1111:2222:33334444:5555:6666:1.2.3.4",
                "1111:2222:3333:44445555:6666:1.2.3.4",
                "1111:2222:3333:4444:55556666:1.2.3.4",
                "1111:2222:3333:4444:5555:66661.2.3.4",

                // Missing .
                "1111:2222:3333:4444:5555:6666:255255.255.255",
                "1111:2222:3333:4444:5555:6666:255.255255.255",
                "1111:2222:3333:4444:5555:6666:255.255.255255",

                // Missing : intended for ::
                ":1.2.3.4",
                ":6666:1.2.3.4",
                ":5555:6666:1.2.3.4",
                ":4444:5555:6666:1.2.3.4",
                ":3333:4444:5555:6666:1.2.3.4",
                ":2222:3333:4444:5555:6666:1.2.3.4",
                ":1111:2222:3333:4444:5555:6666:1.2.3.4",

                // :::
                ":::2222:3333:4444:5555:6666:1.2.3.4",
                "1111:::3333:4444:5555:6666:1.2.3.4",
                "1111:2222:::4444:5555:6666:1.2.3.4",
                "1111:2222:3333:::5555:6666:1.2.3.4",
                "1111:2222:3333:4444:::6666:1.2.3.4",
                "1111:2222:3333:4444:5555:::1.2.3.4",

                // Double ::
                "::2222::4444:5555:6666:1.2.3.4",
                "::2222:3333::5555:6666:1.2.3.4",
                "::2222:3333:4444::6666:1.2.3.4",
                "::2222:3333:4444:5555::1.2.3.4",

                "1111::3333::5555:6666:1.2.3.4",
                "1111::3333:4444::6666:1.2.3.4",
                "1111::3333:4444:5555::1.2.3.4",

                "1111:2222::4444::6666:1.2.3.4",
                "1111:2222::4444:5555::1.2.3.4",

                "1111:2222:3333::5555::1.2.3.4",
                // Missing parts
                "::.",
                "::..",
                "::...",
                "::1...",
                "::1.2..",
                "::1.2.3.",
                "::.2..",
                "::.2.3.",
                "::.2.3.4",
                "::..3.",
                "::..3.4",
                "::...4",
                // Extra : in front
                ":1111:2222:3333:4444:5555:6666:7777::",
                ":1111:2222:3333:4444:5555:6666::",
                ":1111:2222:3333:4444:5555::",
                ":1111:2222:3333:4444::",
                ":1111:2222:3333::",
                ":1111:2222::",
                ":1111::",
                ":::",
                ":1111:2222:3333:4444:5555:6666::8888",
                ":1111:2222:3333:4444:5555::8888",
                ":1111:2222:3333:4444::8888",
                ":1111:2222:3333::8888",
                ":1111:2222::8888",
                ":1111::8888",
                ":::8888",
                ":1111:2222:3333:4444:5555::7777:8888",
                ":1111:2222:3333:4444::7777:8888",
                ":1111:2222:3333::7777:8888",
                ":1111:2222::7777:8888",
                ":1111::7777:8888",
                ":::7777:8888",
                ":1111:2222:3333:4444::6666:7777:8888",
                ":1111:2222:3333::6666:7777:8888",
                ":1111:2222::6666:7777:8888",
                ":1111::6666:7777:8888",
                ":::6666:7777:8888",
                ":1111:2222:3333::5555:6666:7777:8888",
                ":1111:2222::5555:6666:7777:8888",
                ":1111::5555:6666:7777:8888",
                ":::5555:6666:7777:8888",
                ":1111:2222::4444:5555:6666:7777:8888",
                ":1111::4444:5555:6666:7777:8888",
                ":::4444:5555:6666:7777:8888",
                ":1111::3333:4444:5555:6666:7777:8888",
                ":::3333:4444:5555:6666:7777:8888",
                ":::2222:3333:4444:5555:6666:7777:8888",
                ":1111:2222:3333:4444:5555:6666:1.2.3.4",
                ":1111:2222:3333:4444:5555::1.2.3.4",
                ":1111:2222:3333:4444::1.2.3.4",
                ":1111:2222:3333::1.2.3.4",
                ":1111:2222::1.2.3.4",
                ":1111::1.2.3.4",
                ":::1.2.3.4",
                ":1111:2222:3333:4444::6666:1.2.3.4",
                ":1111:2222:3333::6666:1.2.3.4",
                ":1111:2222::6666:1.2.3.4",
                ":1111::6666:1.2.3.4",
                ":::6666:1.2.3.4",
                ":1111:2222:3333::5555:6666:1.2.3.4",
                ":1111:2222::5555:6666:1.2.3.4",
                ":1111::5555:6666:1.2.3.4",
                ":::5555:6666:1.2.3.4",
                ":1111:2222::4444:5555:6666:1.2.3.4",
                ":1111::4444:5555:6666:1.2.3.4",
                ":::4444:5555:6666:1.2.3.4",
                ":1111::3333:4444:5555:6666:1.2.3.4",
                ":::2222:3333:4444:5555:6666:1.2.3.4",

                // Extra : at end
                "1111:2222:3333:4444:5555:6666:7777:::",
                "1111:2222:3333:4444:5555:6666:::",
                "1111:2222:3333:4444:5555:::",
                "1111:2222:3333:4444:::",
                "1111:2222:3333:::",
                "1111:2222:::",
                "1111:::",
                ":::",
                "1111:2222:3333:4444:5555:6666::8888:",
                "1111:2222:3333:4444:5555::8888:",
                "1111:2222:3333:4444::8888:",
                "1111:2222:3333::8888:",
                "1111:2222::8888:",
                "1111::8888:",
                "::8888:",
                "1111:2222:3333:4444:5555::7777:8888:",
                "1111:2222:3333:4444::7777:8888:",
                "1111:2222:3333::7777:8888:",
                "1111:2222::7777:8888:",
                "1111::7777:8888:",
                "::7777:8888:",
                "1111:2222:3333:4444::6666:7777:8888:",
                "1111:2222:3333::6666:7777:8888:",
                "1111:2222::6666:7777:8888:",
                "1111::6666:7777:8888:",
                "::6666:7777:8888:",
                "1111:2222:3333::5555:6666:7777:8888:",
                "1111:2222::5555:6666:7777:8888:",
                "1111::5555:6666:7777:8888:",
                "::5555:6666:7777:8888:",
                "1111:2222::5555:6666:7777:8888:",
                "1111::5555:6666:7777:8888:",
                "::5555:6666:7777:8888:",
                "1111:2222::4444:5555:6666:7777:8888:",
                "1111::4444:5555:6666:7777:8888:",
                "::4444:5555:6666:7777:8888:",
                "1111::3333:4444:5555:6666:7777:8888:",
                "::3333:4444:5555:6666:7777:8888:",
                "::2222:3333:4444:5555:6666:7777:8888:",
        });
    }
}
